(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{285:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var a=r(5155);r(2115);var s=r(4624),n=r(2085),i=r(9434);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:t,variant:r,size:n,asChild:c=!1,...l}=e,d=c?s.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,i.cn)(o({variant:r,size:n,className:t})),...l})}},6695:(e,t,r)=>{"use strict";r.d(t,{Wu:()=>c,ZB:()=>o,Zp:()=>n,aR:()=>i});var a=r(5155);r(2115);var s=r(9434);function n(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function i(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function o(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...r})}function c(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...r})}},6799:(e,t,r)=>{Promise.resolve().then(r.bind(r,7090))},7090:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(5155),s=r(2115),n=r(6695),i=r(285),o=r(9946);let c=(0,o.A)("mic-off",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),l=(0,o.A)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);class d{saveConversation(e){let t={id:this.generateId(),timestamp:new Date,...e};return this.conversations.push(t),this.saveToStorage(),t.id}getRecentConversations(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return this.conversations.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).slice(0,e)}getRelevantContext(e,t){let r=this.conversations.filter(t=>t.language===e).filter(e=>!t||e.context.scenario===t).slice(-3);if(0===r.length)return"";let a=r.map(e=>e.messages.slice(-2).map(e=>"".concat(e.role,": ").concat(e.content)).join("\n")).join("\n\n");return"Previous conversation context:\n".concat(a)}updatePreferences(e,t){this.userPreferences.preferredLanguages.includes(e)||this.userPreferences.preferredLanguages.push(e),this.userPreferences.communicationStyle=t,this.saveToStorage()}addFrequentPhrase(e){this.userPreferences.frequentPhrases.includes(e)||(this.userPreferences.frequentPhrases.push(e),this.userPreferences.frequentPhrases.length>10&&this.userPreferences.frequentPhrases.shift(),this.saveToStorage())}getContextualReplies(e,t){let r=["Yes, please","No, thank you","I don't understand","How much?","Help me"];return this.conversations.filter(e=>e.language===t).length>0?[...r,...this.userPreferences.frequentPhrases.filter(e=>e.length<50).slice(0,3)]:r}cleanup(){this.conversations.length>50&&(this.conversations=this.conversations.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).slice(0,50),this.saveToStorage())}saveToStorage(){localStorage.setItem("clonelingua-memory",JSON.stringify({conversations:this.conversations,preferences:this.userPreferences}))}loadFromStorage(){{let e=localStorage.getItem("clonelingua-memory");if(e)try{let t=JSON.parse(e);this.conversations=t.conversations||[],this.userPreferences={...this.userPreferences,...t.preferences},this.conversations.forEach(e=>{e.timestamp=new Date(e.timestamp)})}catch(e){this.conversations=[],this.userPreferences={preferredLanguages:[],communicationStyle:"friendly",culturalContext:"",frequentPhrases:[]}}}}generateId(){return Math.random().toString(36).substring(2,11)}getPreferences(){return{...this.userPreferences}}clearMemory(){this.conversations=[],this.userPreferences={preferredLanguages:[],communicationStyle:"friendly",culturalContext:"",frequentPhrases:[]},this.saveToStorage()}constructor(){this.conversations=[],this.userPreferences={preferredLanguages:[],communicationStyle:"friendly",culturalContext:"",frequentPhrases:[]},this.loadFromStorage()}}let u=new d;function h(){let[e,t]=(0,s.useState)(!1),[r,o]=(0,s.useState)([]),[d,h]=(0,s.useState)("thai"),g=(0,s.useRef)(null),[p,m]=(0,s.useState)(!1),[f,x]=(0,s.useState)(null),[v,y]=(0,s.useState)(""),b=(0,s.useRef)([]),[k,j]=(0,s.useState)(["Yes, please","No, thank you","I don't understand","How much?","Help me"]);(0,s.useEffect)(()=>{j(u.getContextualReplies(r.map(e=>e.text),d))},[r,d]);let w=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:16e3});g.current=r,b.current=[],y(""),r.ondataavailable=e=>{e.data.size>0&&(b.current.push(e.data),N(e.data))},r.onstop=async()=>{let t=new Blob(b.current,{type:"audio/webm"});try{await P(t)}finally{e.getTracks().forEach(e=>e.stop())}},r.start(250),t(!0)}catch(e){x("Failed to access microphone. Please check permissions.")}},N=async e=>{if(!(e.size<1e3))try{let t=new FormData;t.append("audio",e);let r=await fetch("/api/transcribe",{method:"POST",body:t});if(r.ok){let e=await r.json();e.transcription&&e.transcription.trim()&&y(t=>(t+" "+e.transcription).trim())}}catch(e){}},P=async e=>{m(!0),x(null);try{let t=new FormData;t.append("audio",e);let a=await fetch("/api/transcribe",{method:"POST",body:t});if(!a.ok)throw Error("Failed to transcribe audio");let s=await a.json();if(s.error)throw Error(s.error);let{transcription:n}=s,i=v.trim()||n;o(e=>[...e,{type:"user",text:i}]),y("");let c=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i,language:d,conversationHistory:r.map(e=>({role:"user"===e.type?"user":"assistant",content:e.text})),context:u.getRelevantContext(d)})});if(!c.ok)throw Error("Failed to get AI response");if(!c.body)throw Error("No response body received");let l=c.body.getReader(),h=new TextDecoder,g="",p=-1;if(o(e=>{let t=[...e,{type:"assistant",text:""}];return p=t.length-1,t}),l)try{for(;;){let{done:e,value:t}=await l.read();if(e)break;for(let e of h.decode(t).split("\n"))if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6));if(t.content&&(g=t.fullReply,o(e=>{let t=[...e];return p>=0&&p<t.length&&(t[p].text=g),t})),t.done){g=t.fullReply;break}}catch(e){}}}finally{l.releaseLock()}let m=await fetch("/api/synthesize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:g})});if(!m.ok)throw Error("Failed to synthesize speech");let f=await m.arrayBuffer(),x=new Audio,b=URL.createObjectURL(new Blob([f],{type:"audio/mpeg"}));x.src=b,x.onended=()=>URL.revokeObjectURL(b),x.onerror=()=>URL.revokeObjectURL(b),x.play(),u.saveConversation({language:d,messages:r.map(e=>({role:"user"===e.type?"user":"assistant",content:e.text})),context:{tone:"friendly"}})}catch(e){x(e instanceof Error?e.message:"An unexpected error occurred")}finally{m(!1)}},S=async e=>{o(t=>[...t,{type:"user",text:e}]),m(!0),x(null);try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,language:d,conversationHistory:r.map(e=>({role:"user"===e.type?"user":"assistant",content:e.text})),context:u.getRelevantContext(d)})});if(!t.ok)throw Error("Failed to get AI response");if(!t.body)throw Error("No response body received");let a=t.body.getReader(),s=new TextDecoder,n="",i=-1;if(o(e=>{let t=[...e,{type:"assistant",text:""}];return i=t.length-1,t}),a)try{for(;;){let{done:e,value:t}=await a.read();if(e)break;for(let e of s.decode(t).split("\n"))if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6));if(t.content&&(n=t.fullReply,o(e=>{let t=[...e];return i>=0&&i<t.length&&(t[i].text=n),t})),t.done){n=t.fullReply;break}}catch(e){}}}finally{a.releaseLock()}let c=await fetch("/api/synthesize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n})});if(!c.ok)throw Error("Failed to synthesize speech");let l=await c.arrayBuffer(),h=new Audio,g=URL.createObjectURL(new Blob([l],{type:"audio/mpeg"}));h.src=g,h.onended=()=>URL.revokeObjectURL(g),h.onerror=()=>URL.revokeObjectURL(g),h.play(),u.addFrequentPhrase(e)}catch(e){x(e instanceof Error?e.message:"An unexpected error occurred")}finally{m(!1)}};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-4",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsxs)(n.Zp,{className:"mb-4",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{className:"text-center",children:"CloneLingua"})}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Target Language:"}),(0,a.jsx)("select",{value:d,onChange:e=>h(e.target.value),className:"border border-gray-300 rounded px-2 py-1 text-sm bg-white dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100",children:[{code:"thai",name:"Thai",flag:"\uD83C\uDDF9\uD83C\uDDED"},{code:"hindi",name:"Hindi",flag:"\uD83C\uDDEE\uD83C\uDDF3"},{code:"czech",name:"Czech",flag:"\uD83C\uDDE8\uD83C\uDDFF"},{code:"spanish",name:"Spanish",flag:"\uD83C\uDDEA\uD83C\uDDF8"},{code:"japanese",name:"Japanese",flag:"\uD83C\uDDEF\uD83C\uDDF5"}].map(e=>(0,a.jsxs)("option",{value:e.code,children:[e.flag," ",e.name]},e.code))})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(i.$,{onClick:e?()=>{g.current&&(g.current.stop(),t(!1))}:w,disabled:p,size:"lg",className:"w-20 h-20 rounded-full ".concat(e?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"),children:e?(0,a.jsx)(c,{size:32}):(0,a.jsx)(l,{size:32})})}),(0,a.jsx)("div",{className:"text-center text-sm text-gray-700 dark:text-gray-300",children:e?"Listening...":p?"Processing...":"Tap to speak"}),v&&(0,a.jsxs)("div",{className:"text-center text-sm text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Live Transcription"}),(0,a.jsx)("div",{className:"italic",children:v})]}),f&&(0,a.jsxs)("div",{className:"text-center text-sm text-red-700 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border border-red-200 dark:border-red-800",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Error"}),(0,a.jsx)("div",{children:f}),f.includes("API key")&&(0,a.jsx)("div",{className:"mt-2 text-xs text-red-600 dark:text-red-400",children:"Please configure your OpenAI API key in the environment variables (.env.local)"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Quick Replies:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map((e,t)=>(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>S(e),disabled:p,className:"text-xs",children:e},t))})]})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{className:"text-sm",children:"Conversation"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:0===r.length?(0,a.jsx)("div",{className:"text-center text-gray-700 dark:text-gray-300 text-sm",children:"Start speaking to begin conversation"}):r.map((e,t)=>(0,a.jsxs)("div",{className:"p-3 rounded-lg text-sm ".concat("user"===e.type?"bg-blue-50 dark:bg-blue-900/20 ml-8 border-l-4 border-blue-500":"bg-gray-50 dark:bg-gray-800 mr-8 border-l-4 border-gray-400"),children:[(0,a.jsxs)("div",{className:"font-medium",children:["user"===e.type?"You":"Them",":"]}),(0,a.jsx)("div",{children:e.text}),e.translation&&(0,a.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["Translation: ",e.translation]})]},t))})})]})]})})}},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(2596),s=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[497,441,684,358],()=>t(6799)),_N_E=e.O()}]);
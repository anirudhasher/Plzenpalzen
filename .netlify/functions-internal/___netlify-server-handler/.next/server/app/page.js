(()=>{var e={};e.id=974,e.ids=[974],e.modules={15:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>l});var s=r(5239),a=r(8088),n=r(8170),i=r.n(n),o=r(893),d={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);r.d(t,d);let l={children:["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1204)),"/root/clonelingua/src/app/page.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"/root/clonelingua/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/root/clonelingua/src/app/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},440:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(1658);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,s.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1135:()=>{},1204:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/root/clonelingua/src/app/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/root/clonelingua/src/app/page.tsx","default")},2558:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(687),a=r(3210),n=r(4493),i=r(9523),o=r(2688);let d=(0,o.A)("mic-off",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),l=(0,o.A)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);class c{constructor(){this.conversations=[],this.userPreferences={preferredLanguages:[],communicationStyle:"friendly",culturalContext:"",frequentPhrases:[]},this.loadFromStorage()}saveConversation(e){let t={id:this.generateId(),timestamp:new Date,...e};return this.conversations.push(t),this.saveToStorage(),t.id}getRecentConversations(e=5){return this.conversations.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).slice(0,e)}getRelevantContext(e,t){let r=this.conversations.filter(t=>t.language===e).filter(e=>!t||e.context.scenario===t).slice(-3);if(0===r.length)return"";let s=r.map(e=>e.messages.slice(-2).map(e=>`${e.role}: ${e.content}`).join("\n")).join("\n\n");return`Previous conversation context:
${s}`}updatePreferences(e,t){this.userPreferences.preferredLanguages.includes(e)||this.userPreferences.preferredLanguages.push(e),this.userPreferences.communicationStyle=t,this.saveToStorage()}addFrequentPhrase(e){this.userPreferences.frequentPhrases.includes(e)||(this.userPreferences.frequentPhrases.push(e),this.userPreferences.frequentPhrases.length>10&&this.userPreferences.frequentPhrases.shift(),this.saveToStorage())}getContextualReplies(e,t){let r=["Yes, please","No, thank you","I don't understand","How much?","Help me"];return this.conversations.filter(e=>e.language===t).length>0?[...r,...this.userPreferences.frequentPhrases.filter(e=>e.length<50).slice(0,3)]:r}cleanup(){this.conversations.length>50&&(this.conversations=this.conversations.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).slice(0,50),this.saveToStorage())}saveToStorage(){}loadFromStorage(){}generateId(){return Math.random().toString(36).substring(2,11)}getPreferences(){return{...this.userPreferences}}clearMemory(){this.conversations=[],this.userPreferences={preferredLanguages:[],communicationStyle:"friendly",culturalContext:"",frequentPhrases:[]},this.saveToStorage()}}let u=new c;function h(){let[e,t]=(0,a.useState)(!1),[r,o]=(0,a.useState)([]),[c,h]=(0,a.useState)("thai"),p=(0,a.useRef)(null),[m,g]=(0,a.useState)(!1),[x,v]=(0,a.useState)(null),[f,b]=(0,a.useState)(""),y=(0,a.useRef)([]),[k,j]=(0,a.useState)(["Yes, please","No, thank you","I don't understand","How much?","Help me"]),P=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:16e3});p.current=r,y.current=[],b(""),r.ondataavailable=e=>{e.data.size>0&&(y.current.push(e.data),w(e.data))},r.onstop=async()=>{let t=new Blob(y.current,{type:"audio/webm"});try{await N(t)}finally{e.getTracks().forEach(e=>e.stop())}},r.start(250),t(!0)}catch{v("Failed to access microphone. Please check permissions.")}},w=async e=>{if(!(e.size<1e3))try{let t=new FormData;t.append("audio",e);let r=await fetch("/api/transcribe",{method:"POST",body:t});if(r.ok){let e=await r.json();e.transcription&&e.transcription.trim()&&b(t=>(t+" "+e.transcription).trim())}}catch{}},N=async e=>{g(!0),v(null);try{let t=new FormData;t.append("audio",e);let s=await fetch("/api/transcribe",{method:"POST",body:t});if(!s.ok)throw Error("Failed to transcribe audio");let a=await s.json();if(a.error)throw Error(a.error);let{transcription:n}=a,i=f.trim()||n;o(e=>[...e,{type:"user",text:i}]),b("");let d=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i,language:c,conversationHistory:r.map(e=>({role:"user"===e.type?"user":"assistant",content:e.text})),context:u.getRelevantContext(c)})});if(!d.ok)throw Error("Failed to get AI response");if(!d.body)throw Error("No response body received");let l=d.body.getReader(),h=new TextDecoder,p="",m=-1;if(o(e=>{let t=[...e,{type:"assistant",text:""}];return m=t.length-1,t}),l)try{for(;;){let{done:e,value:t}=await l.read();if(e)break;for(let e of h.decode(t).split("\n"))if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6));if(t.content&&(p=t.fullReply,o(e=>{let t=[...e];return m>=0&&m<t.length&&(t[m].text=p),t})),t.done){p=t.fullReply;break}}catch{}}}finally{l.releaseLock()}let g=await fetch("/api/synthesize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:p})});if(!g.ok)throw Error("Failed to synthesize speech");let x=await g.arrayBuffer(),v=new Audio,y=URL.createObjectURL(new Blob([x],{type:"audio/mpeg"}));v.src=y,v.onended=()=>URL.revokeObjectURL(y),v.onerror=()=>URL.revokeObjectURL(y),v.play(),u.saveConversation({language:c,messages:r.map(e=>({role:"user"===e.type?"user":"assistant",content:e.text})),context:{tone:"friendly"}})}catch(e){v(e instanceof Error?e.message:"An unexpected error occurred")}finally{g(!1)}},S=async e=>{o(t=>[...t,{type:"user",text:e}]),g(!0),v(null);try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,language:c,conversationHistory:r.map(e=>({role:"user"===e.type?"user":"assistant",content:e.text})),context:u.getRelevantContext(c)})});if(!t.ok)throw Error("Failed to get AI response");if(!t.body)throw Error("No response body received");let s=t.body.getReader(),a=new TextDecoder,n="",i=-1;if(o(e=>{let t=[...e,{type:"assistant",text:""}];return i=t.length-1,t}),s)try{for(;;){let{done:e,value:t}=await s.read();if(e)break;for(let e of a.decode(t).split("\n"))if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6));if(t.content&&(n=t.fullReply,o(e=>{let t=[...e];return i>=0&&i<t.length&&(t[i].text=n),t})),t.done){n=t.fullReply;break}}catch{}}}finally{s.releaseLock()}let d=await fetch("/api/synthesize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n})});if(!d.ok)throw Error("Failed to synthesize speech");let l=await d.arrayBuffer(),h=new Audio,p=URL.createObjectURL(new Blob([l],{type:"audio/mpeg"}));h.src=p,h.onended=()=>URL.revokeObjectURL(p),h.onerror=()=>URL.revokeObjectURL(p),h.play(),u.addFrequentPhrase(e)}catch(e){v(e instanceof Error?e.message:"An unexpected error occurred")}finally{g(!1)}};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-4",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,s.jsxs)(n.Zp,{className:"mb-4",children:[(0,s.jsx)(n.aR,{children:(0,s.jsx)(n.ZB,{className:"text-center",children:"CloneLingua"})}),(0,s.jsxs)(n.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Target Language:"}),(0,s.jsx)("select",{value:c,onChange:e=>h(e.target.value),className:"border border-gray-300 rounded px-2 py-1 text-sm bg-white dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100",children:[{code:"thai",name:"Thai",flag:"\uD83C\uDDF9\uD83C\uDDED"},{code:"hindi",name:"Hindi",flag:"\uD83C\uDDEE\uD83C\uDDF3"},{code:"czech",name:"Czech",flag:"\uD83C\uDDE8\uD83C\uDDFF"},{code:"spanish",name:"Spanish",flag:"\uD83C\uDDEA\uD83C\uDDF8"},{code:"japanese",name:"Japanese",flag:"\uD83C\uDDEF\uD83C\uDDF5"}].map(e=>(0,s.jsxs)("option",{value:e.code,children:[e.flag," ",e.name]},e.code))})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(i.$,{onClick:e?()=>{p.current&&(p.current.stop(),t(!1))}:P,disabled:m,size:"lg",className:`w-20 h-20 rounded-full ${e?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"}`,children:e?(0,s.jsx)(d,{size:32}):(0,s.jsx)(l,{size:32})})}),(0,s.jsx)("div",{className:"text-center text-sm text-gray-700 dark:text-gray-300",children:e?"Listening...":m?"Processing...":"Tap to speak"}),f&&(0,s.jsxs)("div",{className:"text-center text-sm text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,s.jsx)("div",{className:"font-medium mb-1",children:"Live Transcription"}),(0,s.jsx)("div",{className:"italic",children:f})]}),x&&(0,s.jsxs)("div",{className:"text-center text-sm text-red-700 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border border-red-200 dark:border-red-800",children:[(0,s.jsx)("div",{className:"font-medium mb-1",children:"Error"}),(0,s.jsx)("div",{children:x}),x.includes("API key")&&(0,s.jsx)("div",{className:"mt-2 text-xs text-red-600 dark:text-red-400",children:"Please configure your OpenAI API key in the environment variables (.env.local)"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Quick Replies:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map((e,t)=>(0,s.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>S(e),disabled:m,className:"text-xs",children:e},t))})]})]})]}),(0,s.jsxs)(n.Zp,{children:[(0,s.jsx)(n.aR,{children:(0,s.jsx)(n.ZB,{className:"text-sm",children:"Conversation"})}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:0===r.length?(0,s.jsx)("div",{className:"text-center text-gray-700 dark:text-gray-300 text-sm",children:"Start speaking to begin conversation"}):r.map((e,t)=>(0,s.jsxs)("div",{className:`p-3 rounded-lg text-sm ${"user"===e.type?"bg-blue-50 dark:bg-blue-900/20 ml-8 border-l-4 border-blue-500":"bg-gray-50 dark:bg-gray-800 mr-8 border-l-4 border-gray-400"}`,children:[(0,s.jsxs)("div",{className:"font-medium",children:["user"===e.type?"You":"Them",":"]}),(0,s.jsx)("div",{children:e.text}),e.translation&&(0,s.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["Translation: ",e.translation]})]},t))})})]})]})})}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3084:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,6346,23)),Promise.resolve().then(r.t.bind(r,7924,23)),Promise.resolve().then(r.t.bind(r,5656,23)),Promise.resolve().then(r.t.bind(r,99,23)),Promise.resolve().then(r.t.bind(r,8243,23)),Promise.resolve().then(r.t.bind(r,8827,23)),Promise.resolve().then(r.t.bind(r,2763,23)),Promise.resolve().then(r.t.bind(r,7173,23))},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3441:(e,t,r)=>{Promise.resolve().then(r.bind(r,2558))},3873:e=>{"use strict";e.exports=require("path")},4090:()=>{},4431:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l,metadata:()=>d});var s=r(7413),a=r(2202),n=r.n(a),i=r(4988),o=r.n(i);r(1135);let d={title:"Create Next App",description:"Generated by create next app"};function l({children:e}){return(0,s.jsx)("html",{lang:"en",children:(0,s.jsx)("body",{className:`${n().variable} ${o().variable} antialiased`,children:e})})}},4493:(e,t,r)=>{"use strict";r.d(t,{Wu:()=>d,ZB:()=>o,Zp:()=>n,aR:()=>i});var s=r(687);r(3210);var a=r(4780);function n({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...t})}function i({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...t})}function o({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...t})}function d({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...t})}},4780:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var s=r(9384),a=r(2348);function n(...e){return(0,a.QP)((0,s.$)(e))}},6993:(e,t,r)=>{Promise.resolve().then(r.bind(r,1204))},7138:()=>{},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9523:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var s=r(687);r(3210);var a=r(1391),n=r(4224),i=r(4780);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d({className:e,variant:t,size:r,asChild:n=!1,...d}){let l=n?a.DX:"button";return(0,s.jsx)(l,{"data-slot":"button",className:(0,i.cn)(o({variant:t,size:r,className:e})),...d})}},9532:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,6444,23)),Promise.resolve().then(r.t.bind(r,6042,23)),Promise.resolve().then(r.t.bind(r,8170,23)),Promise.resolve().then(r.t.bind(r,9477,23)),Promise.resolve().then(r.t.bind(r,9345,23)),Promise.resolve().then(r.t.bind(r,2089,23)),Promise.resolve().then(r.t.bind(r,6577,23)),Promise.resolve().then(r.t.bind(r,1307,23))},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,169,139],()=>r(15));module.exports=s})();